# 大模型API中转站需求文档

## 项目目标
逆向 DeepSeek 和 KIMI 官网的网页版对话 API，在本地 8000 端口提供统一的 OpenAI 兼容 API 接口。

## 目标厂商
- DeepSeek
- Kimi（月之暗面）
- Metaso（秘塔AI搜索）
- 豆包（字节跳动）
- 千问（通义千问，阿里云）
- 智谱清言（ChatGLM，智谱AI）

**注意**：必须通过逆向 API 方式实现，不使用浏览器自动化方案。

---

## ⚠️ 核心要求（必须严格遵守）

**无论遇到多大困难，必须完成以下工作：**

1. **必须逆向出具体的签名/加密算法**
   - 不能仅靠抓包复制请求参数，必须分析并还原算法逻辑
   - 包括但不限于：签名算法、加密算法、Token生成算法、时间戳校验等
   - 必须能够独立生成所需的请求参数，而非依赖抓包获取的固定值

2. **必须用代码实现逆向出的算法**
   - 将逆向分析的算法用 Python 代码完整实现
   - 代码实现必须能够独立运行，不依赖外部工具或手动操作
   - 实现的算法必须能够正确调用目标 API

3. **禁止的偷懒行为**
   - ❌ 禁止仅复制抓包的请求参数（如固定的 token、signature 等）
   - ❌ 禁止使用浏览器自动化（Selenium、Playwright、Puppeteer 等）
   - ❌ 禁止使用任何需要启动浏览器的方案
   - ❌ 禁止以"算法太复杂"为由放弃逆向

4. **必须交付的内容**
   - 完整的算法逆向分析文档（包含算法原理、参数说明）
   - 可运行的 Python 算法实现代码
   - 能够独立调用 API 的完整模块

**即使算法涉及复杂的加密、混淆、反调试等技术，也必须攻克并实现。这是本项目的核心价值所在。**

---

## 功能需求

### 1. API逆向与实现
- 通过抓包工具捕获各厂商网页版对话的 API 调用
- 分析每个厂商的 API 调用方式（请求头、参数、签名等）
- 实现各厂商 API 的调用逻辑
- 统一转换为 OpenAI 兼容格式

### 2. 统一API接口
在本地 8000 端口提供 OpenAI 兼容的 API 接口：
- `POST /v1/chat/completions` - 对话补全接口
- `GET /v1/models` - 模型列表接口
- 支持 streaming 响应

### 3. 认证信息管理
- 支持从配置文件或环境变量读取认证信息（token/cookie）
- 不硬编码敏感信息

## 技术实现方案

### 技术方案：直接逆向API
**核心思路**：
- 通过抓包工具（如 Fiddler、Charles、浏览器开发者工具、CDP）捕获 API 请求
- 分析请求的 URL、Headers、Body、签名算法等
- 使用 Python 直接模拟 HTTP 请求调用 API
- 不依赖浏览器自动化，纯 API 层面实现

**实现步骤**：
1. 使用抓包工具捕获官网对话的完整 API 请求
2. 分析请求头、请求体、认证方式、签名算法
3. 提取关键参数和加密逻辑（如需要）
4. 使用 httpx/aiohttp 实现 API 调用
5. 统一转换为 OpenAI 兼容格式

### 推荐技术栈
- **后端框架**：Python + FastAPI (异步高性能，OpenAI 兼容性好)
- **HTTP客户端**：httpx (支持异步和 streaming)
- **配置管理**：Pydantic + YAML/环境变量

## 项目结构建议

```
nxapi/
├── src/
│   ├── api/              # API接口层
│   │   ├── openai/       # OpenAI兼容接口
│   │   └── providers/    # 各厂商API实现
│   ├── core/             # 核心功能
│   │   ├── request_handler.py   # 请求处理
│   │   └── response_converter.py # 响应转换
│   ├── models/           # 数据模型
│   └── config/           # 配置文件
├── tests/                # 测试用例
├── requirements.txt      # 依赖
└── README.md            # 说明文档
```

## 交付物
1. API 中转服务代码（本地 8000 端口运行）
2. DeepSeek API 调用模块
3. KIMI API 调用模块
4. Metaso API 调用模块
5. 豆包 API 调用模块
6. 千问 API 调用模块
7. 智谱清言 API 调用模块
8. 使用文档

## 实施路线图

### 第1天：API分析
- [x] 抓包分析 DeepSeek 官网 API 调用
- [x] 抓包分析 KIMI 官网 API 调用
- [x] 抓包分析 Metaso 官网 API 调用
- [x] 抓包分析豆包官网 API 调用
- [x] 抓包分析千问官网 API 调用
- [x] 抓包分析智谱清言官网 API 调用

### 第2-3天：核心功能开发
- [x] 实现 DeepSeek API 调用模块
- [x] 实现 KIMI API 调用模块
- [x] 实现 Metaso API 调用模块
- [x] 实现豆包 API 调用模块
- [x] 实现千问 API 调用模块
- [x] 实现智谱清言 API 调用模块
- [x] 实现 OpenAI 格式转换
- [x] 完成本地 8000 端口服务

### 第4天：测试与优化
- [ ] 测试各厂商 API 调用
- [ ] 测试 streaming 响应
- [ ] 编写使用文档

## 注意事项
- 需求.md 文件不要删除
- 测试成功后删除不必要的临时文件
- 确保 API 转发功能正常可用
